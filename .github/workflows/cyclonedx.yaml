name: CycloneDX

on:
  push:
    branches:
      - '*frontend*'
      - '*backend*'

jobs:
  cyclonedx:
    name: CycloneDX
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install and Build
        run: |
          if [[ $GITHUB_REF == *frontend* ]]; then
            cd frontend
            npm install
          elif [[ $GITHUB_REF == *backend* ]]; then
            cd backend
            npm install
          fi
      - name: Generate SBOM with CycloneDX
        run: |
          if [[ $GITHUB_REF == *frontend* ]]; then
            cd frontend
            npm run cyclonedx
          elif [[ $GITHUB_REF == *backend* ]]; then
            cd backend
            npm run cyclonedx
          fi
      - name: Upload SBOM artifact
        uses: actions/upload-artifact@v2
        with:
          name: ${{ github.event_name == 'push' && contains(github.ref, 'frontend') && 'sbom_frontend.xml' || 'sbom_backend.xml' }}
          path: ${{ github.event_name == 'push' && contains(github.ref, 'frontend') && 'frontend/sbom.xml' || 'backend/sbom.xml' }}
